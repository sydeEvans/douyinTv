## 项目逻辑梳理
- 播放器：使用 `GSYVideoPlayer` 的 `StandardGSYVideoPlayer`（`activity_main.xml`:10-16；`MainActivity.kt`:30, 68-73）。
- 播放流程：`playVideo()` 完成 setUp→start（`MainActivity.kt`:119-143），并在播放期保持屏幕常亮。
- 源选择：按 HEVC/AVC 能力、分辨率与码率挑选最佳候选（`MainActivity.kt`:215-251），并过滤不可用解码器（`MainActivity.kt`:253-277）。HEVC 能力缓存（`MainActivity.kt`:279-296）。
- 遥控交互：上下切换、左右短/长按快进快退、中心键暂停恢复（`MainActivity.kt`:337-391, 394-406, 408-446）。
- 监控与容错：加载 8s 超时、10s 进度不变或错误跳下一条（`MainActivity.kt`:145-186, 188-201）。
- 数据层：`Retrofit`/`OkHttp` 拉取 Douyin feed，包含大量头与 token（`NetworkClient.kt`:13-33, 35-43；`DouyinApi.kt`:8-62）。
- UI：开场信息叠层 3s 自动隐藏、暂停时常显（`MainActivity.kt`:298-316, 372-389；`activity_main.xml`:27-55）。

## 问题诊断
- 无播放缓存：直连 HTTP，重复观看或快进回退命中网络，易抖动与卡顿。
- 监控过于保守：仅靠进度变化与错误态；未区分缓冲开始/结束，易误判或迟判。
- 错误回退有限：选择源时做能力过滤，但播放期遇到解码/连接错误未进行 codec/URL 级别回退。
- 体验细节：长按快进快退无时间提示；缓冲时缺少明显指示；暂停/恢复未绑定 Activity 生命周期。
- 网络层风险：硬编码长 Cookie/令牌易过期且不安全；`OkHttp` 未启用磁盘缓存；无断网重试策略。

## 近期优化（保留 GSY 路线）
- 播放状态监听与缓冲指示：
  - 绑定 `GSYVideoView` 状态回调，缓冲开始显示 `loadingBar`，缓冲结束隐藏（改动：`MainActivity.kt` 播放器初始化处 68-73）。
  - 将“进度不变 10s”判定替换为“连续缓冲超过阈值/错误态”触发跳转（改动：`MainActivity.kt`:145-186）。
- 错误与回退策略：
  - 播放错误时尝试同一 `aweme` 的次优候选（AVC↔HEVC 切换，分辨率降级），失败再跳下一条（改动：`MainActivity.kt`:203-212, 215-251, 145-186）。
  - 首 URL 失败时尝试备用 URL（`urlList` 次序回退）（改动：`MainActivity.kt`:209-212）。
- Seek 体验：
  - 长按时在叠层显示当前进度 `mm:ss`，松开隐藏（改动：`MainActivity.kt`:418-446, 460-465, 298-316；`activity_main.xml`:27-55）。
  - 自适应长按步长：按住时间越久，步长由 5s 逐步提升至 10-15s（改动：`MainActivity.kt`:418-436）。
- 预加载下一条：
  - 在 `playVideo(i)` 后后台预解析 `i+1` 的 URL，并做 HEAD 预热（DNS/TLS 连接复用），缩短首帧时间（改动：`MainActivity.kt`:139-143 附近新增）。
- 生命周期绑定：
  - `onResume()` 恢复播放并设置常亮；`onPause()` 暂停并清除常亮，取消看门狗（改动：`MainActivity.kt` 新增方法并复用已有逻辑 372-389, 447-455）。
- 网络与缓存：
  - 启用 `OkHttp` 磁盘缓存（50-100MB）与合适的 Cache-Control，降低重复请求（改动：`NetworkClient.kt`:30-33）。
  - 弱网重试：为媒体请求添加有限次重试与指数退避（改动：`NetworkClient.kt`:13-28 增强拦截器）。
- 安全治理：
  - 抽离敏感令牌/长 Cookie 至本地配置或调试构建变量，运行期校验并容错（改动：`NetworkClient.kt`:13-28）。

## 中期优化（可选迁移到 Media3/ExoPlayer）
- 视图：替换为 `StyledPlayerView`，使用内置控制器与时间轴（`media3-ui` 已引入，`app/build.gradle`:60-65）。
- 播放器：`ExoPlayer` + `DefaultLoadControl` 调优缓冲；`ProgressiveMediaSource` 适配 MP4 源。
- 缓存：`SimpleCache` + `CacheDataSource` 实现磁盘缓存与读写合并；首帧显著优化。
- 事件：使用 `Player.Listener` 精确区分 `BUFFERING/READY/ENDED/ERROR`，完善看门狗与回退逻辑。
- Seek：`SeekParameters.CLOSEST_SYNC` 降低跳转后马赛克；长按走内置时间轴。
- 渐进迁移：先双栈（保留 GSY 作为兜底），完成 A/B 比较后切换默认。

## 详细改动清单（按文件）
- `app/src/main/java/com/example/douyintv/MainActivity.kt`
  - 初始化：增加状态监听与缓冲指示（68-73）。
  - 播放：错误回退与备用 URL 尝试（119-143, 145-186, 203-212, 215-251）。
  - Seek：长按自适应步长与时间叠层（337-371, 394-446, 460-465, 298-316）。
  - 生命周期：新增 `onResume`/`onPause` 绑定常亮与监控（372-389, 447-455）。
  - 预加载：在分页逻辑附近添加下一条预热（139-143）。
- `app/src/main/java/com/example/douyintv/data/NetworkClient.kt`
  - 启用 `OkHttp` 缓存与重试；抽离敏感头（13-33, 30-33）。
- `app/src/main/res/layout/activity_main.xml`
  - 保持 `StandardGSYVideoPlayer` 与信息叠层，复用缓冲与时间显示（10-16, 27-55）。
- `app/build.gradle`
  - 若迁移 Media3：使用 `media3` 依赖；调试开关控制双栈（60-79）。

## 验证与度量
- 指标：首帧耗时（冷/热）、缓冲次数与总时长、错误率、跳转成功率、遥控响应延迟。
- 验证流程：
  - 弱网模拟（限速、丢包）下对比缓存与无缓存；HEVC/AVC 不同源的回退正确性。
  - 长按 seek 连续 30s，观察马赛克与跳帧；缓冲指示与时间叠层的协同。
  - 生命周期切换（Home、屏保）后稳定恢复与资源释放。
- 日志：增加关键事件埋点（缓冲开始/结束、错误类型、回退路径、分页拉取耗时）。

## 执行与风险控制
- 先落地“近期优化”全部项，保持 GSY，不引入新依赖；对真实设备（含 HEVC/AVC 差异机型）验证。
- 迁移到 Media3 作为可选第二阶段，双栈测试后切换默认。
- 令牌与 Cookie 管理改为本地配置，避免提交敏感信息并减少过期带来的不可用风险。

请确认是否按此方案推进；确认后我将开始分步实现与验证。